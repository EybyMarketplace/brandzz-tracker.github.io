/* Traffic Tracker v1.0.0 | 2025-07-22T15:07:05.862Z */
!function(t,e){"use strict";const n={apiEndpoint:"",projectId:"",enableConsentCheck:!0,batchSize:10,batchTimeout:3e3,sessionTimeout:18e5,version:"1.0.0"},i={checkConsent:function(){return!n.enableConsentCheck||"granted"===localStorage.getItem("analytics_consent")},waitForConsent:function(t){const e=setInterval(()=>{this.checkConsent()&&(clearInterval(e),t())},500);setTimeout(()=>{clearInterval(e)},1e4)}},r={generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},getUserId:function(){let t=localStorage.getItem("inf_user_id");return t||(t=this.generateUUID(),localStorage.setItem("inf_user_id",t)),t},getSessionId:function(){let t=sessionStorage.getItem("inf_session");if(t){const e=JSON.parse(t),i=Date.now();if(i-e.lastActivity<n.sessionTimeout)return e.lastActivity=i,sessionStorage.setItem("inf_session",JSON.stringify(e)),e.id}const e={id:this.generateUUID(),startTime:Date.now(),lastActivity:Date.now()};return sessionStorage.setItem("inf_session",JSON.stringify(e)),e.id}},o=function(){const e=t.screen,n=navigator;return{user_agent:n.userAgent,language:n.language,platform:n.platform,screen_resolution:`${e.width}x${e.height}`,color_depth:e.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,device_memory:n.deviceMemory||null,hardware_concurrency:n.hardwareConcurrency||null,connection:n.connection?{effective_type:n.connection.effectiveType,downlink:n.connection.downlink}:null}},a={queue:[],add:function(t){this.queue.push(t),this.queue.length>=n.batchSize&&this.flush()},flush:function(){if(0===this.queue.length||!n.apiEndpoint)return;const t=this.queue.splice(0,n.batchSize);fetch(n.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:n.projectId,events:t,version:n.version})}).catch(e=>{console.warn("Influencer Tracker: Failed to send events",e);const n=JSON.parse(localStorage.getItem("inf_failed_events")||"[]");n.push(...t),localStorage.setItem("inf_failed_events",JSON.stringify(n.slice(-100)))})},scheduleFlush:function(){this.flushTimer&&clearTimeout(this.flushTimer),this.flushTimer=setTimeout(()=>this.flush(),n.batchTimeout)}},c={initialized:!1,startTime:Date.now(),init:function(t={}){this.initialized||(Object.assign(n,t),n.apiEndpoint?!n.enableConsentCheck||i.checkConsent()?this.startTracking():i.waitForConsent(()=>this.startTracking()):console.warn("Influencer Tracker: apiEndpoint nÃ£o configurado"))},startTracking:function(){this.initialized=!0;const n=function(){const n=new URLSearchParams(t.location.search),i=new URLSearchParams(t.location.hash.substring(1)),r={influencer_id:n.get("inf_id")||n.get("influencer")||i.get("inf_id"),campaign_id:n.get("camp_id")||n.get("campaign")||i.get("camp_id"),promo_code:n.get("promo")||n.get("codigo")||i.get("promo"),utm_source:n.get("utm_source"),utm_medium:n.get("utm_medium"),utm_campaign:n.get("utm_campaign"),ref:n.get("ref")},o=e.referrer;let a=null;if(o.includes("instagram.com")?a="instagram":o.includes("tiktok.com")?a="tiktok":o.includes("youtube.com")||o.includes("youtu.be")?a="youtube":o.includes("facebook.com")?a="facebook":(o.includes("twitter.com")||o.includes("x.com"))&&(a="twitter"),Object.values(r).some(t=>null!==t)||a){const e={...r,social_source:a,detected_at:Date.now(),landing_page:t.location.href};return sessionStorage.setItem("inf_attribution",JSON.stringify(e)),e}const c=sessionStorage.getItem("inf_attribution");return c?JSON.parse(c):null}();this.track("page_view",{page_url:t.location.href,page_title:e.title,referrer:e.referrer,influencer_data:n}),this.setupEventListeners(),a.scheduleFlush(),t.addEventListener("beforeunload",()=>a.flush()),console.log("Influencer Tracker: Inicializado com sucesso")},track:function(e,n={}){if(!this.initialized)return;const i={event_id:r.generateUUID(),event_type:e,timestamp:Date.now(),user_id:r.getUserId(),session_id:r.getSessionId(),page_url:t.location.href,device_fingerprint:o(),properties:n};a.add(i)},setupEventListeners:function(){let n=0;t.addEventListener("scroll",this.throttle(()=>{const i=Math.round(t.scrollY/(e.body.scrollHeight-t.innerHeight)*100);i>n&&(n=i,[25,50,75,90].includes(i)&&this.track("scroll_milestone",{scroll_percent:i}))},1e3)),e.addEventListener("click",t=>{const e=t.target,n={element_tag:e.tagName,element_classes:e.className,element_id:e.id,element_text:e.textContent?.substring(0,100),x:t.clientX,y:t.clientY};e.matches("[data-product-id]")?(n.product_id=e.getAttribute("data-product-id"),this.track("product_click",n)):e.matches('.btn-buy, .add-to-cart, [data-action="add-cart"]')?this.track("add_to_cart_attempt",n):e.matches('.btn-checkout, [data-action="checkout"]')?this.track("checkout_attempt",n):this.track("click",n)}),e.addEventListener("submit",t=>{const e=t.target;this.track("form_submit",{form_id:e.id,form_classes:e.className,form_action:e.action,field_count:e.elements.length})});let i=0;setInterval(()=>{i+=10,[30,60,120,300].includes(i)&&this.track("time_milestone",{seconds_on_page:i})},1e4),this.setupProductTracking(),this.setupCartTracking(),this.setupExitTracking()},setupProductTracking:function(){const t=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const e=t.target;this.track("product_view",{product_id:e.getAttribute("data-product-id"),product_name:e.getAttribute("data-product-name"),product_price:e.getAttribute("data-product-price"),product_category:e.getAttribute("data-product-category"),visibility_percent:Math.round(100*t.intersectionRatio)})}})},{threshold:.5});e.querySelectorAll("[data-product-id]").forEach(e=>{t.observe(e)})},setupCartTracking:function(){const t=new MutationObserver(()=>{const t=e.querySelectorAll("[data-cart-item]").length,n=this.getCartValue();this.track("cart_update",{cart_items:t,cart_value:n})}),n=e.querySelector("[data-cart-container]")||e.body;t.observe(n,{childList:!0,subtree:!0})},setupExitTracking:function(){let n=!1;e.addEventListener("mouseleave",i=>{i.clientY<=0&&!n&&(n=!0,this.track("exit_intent",{time_on_page:Date.now()-this.startTime,scroll_percent:Math.round(t.scrollY/(e.body.scrollHeight-t.innerHeight)*100)}))})},getCartValue:function(){const t=["[data-cart-total]",".cart-total","#cart-total",".basket-total"];for(const n of t){const t=e.querySelector(n);if(t){const e=t.textContent||t.value,n=parseFloat(e.replace(/[^\d.,]/g,"").replace(",","."));if(!isNaN(n))return n}}return null},trackPurchase:function(t){this.track("purchase",{order_id:t.orderId,total_value:t.totalValue,currency:t.currency||"BRL",items:t.items,coupon_code:t.couponCode,influencer_attribution:JSON.parse(sessionStorage.getItem("inf_attribution")||"null")})},trackCustomEvent:function(t,e){this.track(t,e)},throttle:function(t,e){let n;return function(){const i=arguments;n||(t.apply(this,i),n=!0,setTimeout(()=>n=!1,e))}}};t.InfluencerTracker=c,e.addEventListener("DOMContentLoaded",()=>{const t=e.querySelector("script[data-inf-endpoint]");t&&c.init({apiEndpoint:t.getAttribute("data-inf-endpoint"),projectId:t.getAttribute("data-inf-project"),enableConsentCheck:"false"!==t.getAttribute("data-inf-consent")})})}(window,document);